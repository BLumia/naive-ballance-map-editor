# ballance 关卡生成工具

## 是什么

这是一个替代由 jxpxxzj 开发的关卡编辑器的简易工具（尽管当前状态还不能做到替代）。在当前版本中，能够导入和导出 bme 格式的文档，导出的 bme 格式文档将能够在 jxpxxzj 的编辑器中重新打开，并导出为所需的脚本以供导入 blender 或 3ds Max 中进行后续的编辑工作。

此工具旨在提供相对 jxpxxzj 工具更易用的操作方式来达到加快关卡原型设计速度的目的。

## 构建

此项目使用 Godot Engine 3.2.2 进行开发，您只需获取 Godot Engine 即可载入项目进行开发和构建。

## 使用注意事项

### 导入和导出

目前的数据交换格式为 bme ，对应 jxpxxzj 的编辑器所存储的格式，但注意，其提供的功能并非受到完整支持，例如 `[sign]` 是不支持的数据。另外此工具工作区并没有区域大小限制，故并不能总是保证导出的数据在原编辑器中一定能打开。

因此，永远不建议您在保存时使用此工具的保存功能直接覆盖您由 jxpxxzj 编辑器保存的 bme 文档，而应当保存为新的文档。

## 开发注意事项

### 代码质量及预期完成度

鉴于我的空闲时间并不多，本身对 Godot Engine 也并不熟悉（边看文档边写的），故初版将只是能达到能够正常导入和导出 bme 格式文档的程度，并能够在工作区完成和 jxpxxzj 版编辑器基本一致的编辑操作。

实际上若对 Godot Engine 进行深入研究，则可以对此工具丰富很多更实用的功能，yyc 所提供的新的 ballance 的 blender 制图工具链极大程度的简化了制图的流程并改善了体验，对此项目扩展功能来对接其工具链也将会是不错的主意。但限于精力且暂时无人合作，故目前将不计划进行这些内容的开发，但希望开放此程序的源码可以帮助感兴趣的人完善此工具，打造自己的制图工具。

限于时间和精力的缘故，此工具在开发过程中并未刻意关注代码质量，故如果你决定进行二次开发，请先准备好撒气玩偶 :P

### GridMap 相关

我们假定的最小单元格为长宽 2.5m x 2.5m 为一格，表示为 1x1 （注：路面高度为 5m，可记做 1x1x2），我们则会混用 1x1 和 2x2 的格子。由于 Godot 所提供的 GridMap 并非完全适用于此场景（最佳情况为所有方块具备相同的尺寸，例如都是 2.5m x 2.5m 或都是 5m x 5m），故此程序的实现中通过调整 2x2 格子中心点，并通过代码简单处理的方式，来达到使得 2x2 方块在 1x1 的 GridMap 中可以正确放置的目的。

所有 1x1x2 格的中心点均为其 mesh 的 bounding box 的中心，对于 2x2x2 的格子，假定其由四个 1x1x2 的格子构成，则其第一个 1x1x2 格的中心点则为此 2x2x2 格子的中心，也将是其在 GridMap 中所存储数据的格子。由于 2x2x2 格子的中心点位置的并非在其 mesh bounding box 的中心，故在 Godot 的 GridMap 中进行旋转时，其视觉上所占据的周边格子将根据旋转角度而不同。

也由于上述的混用 1x1 与 2x2 方块于同一 GridMap 的缘故，直接使用 Godot Engine 编辑器中的 GridMap 将会比较痛苦，此项目所生成的工具则会对由此造成的情况进行处理，也是此项目源码中要处理的比较蛋疼的地方之一。
